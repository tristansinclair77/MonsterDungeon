### Visual Studio Copilot Instructions — Player & Enemy Movement Implementation

#### Objective:

Implement keyboard-based player movement and synchronized enemy descent behavior for the combat grid within the **Monster Dungeon** project.

---

## ENEMY BEHAVIOR (New Functionality)

### Step 5: Spawn Enemies Randomly on Top Row

* Every few player moves (random between 1–3), spawn new enemies in **random empty top-row tiles**.
* Limit spawn count to **1–3 enemies per wave**.
* Use a simple turn counter to decide when to spawn.

```csharp
private int moveCounter = 0;
private Random random = new Random();
private List<Enemy> enemies = new List<Enemy>();

private void TrySpawnEnemies()
{
    if (moveCounter >= random.Next(1, 4)) // 1–3 moves
    {
        int spawnCount = random.Next(1, 4); // 1–3 enemies
        for (int i = 0; i < spawnCount; i++)
        {
            int x = random.Next(0, GridService.GridWidth);
            if (!enemies.Any(e => e.Position.Y == 0 && e.Position.X == x))
            {
                enemies.Add(new Enemy { Position = new Point(x, 0) });
            }
        }
        moveCounter = 0;
    }
}
```

### Step 6: Enemy Descent Logic

* Each time the player moves, enemies descend by one tile.
* If an enemy is about to move into the player’s row, remove it instead.

```csharp
private void ProcessEnemyMovement()
{
    moveCounter++;
    TrySpawnEnemies();

    for (int i = enemies.Count - 1; i >= 0; i--)
    {
        var enemy = enemies[i];
        int newY = enemy.Position.Y + 1;

        // Check if next move is player row
        if (newY >= GridService.GridHeight - 1)
        {
            enemies.RemoveAt(i); // Enemy disappears instead of colliding
            continue;
        }

        enemy.Position = new Point(enemy.Position.X, newY);
    }

    RenderEnemies();
}
```

### Step 7: Rendering Enemies

* Redraw enemy sprites each frame after movement.
* Example (Canvas-based):

```csharp
foreach (var enemy in enemies)
{
    Canvas.SetLeft(enemy.Sprite, enemy.Position.X * TileSize);
    Canvas.SetTop(enemy.Sprite, enemy.Position.Y * TileSize);
}
```

---

### Step 8: Testing Checklist

✅ Player moves one tile per tap only (not continuous)
✅ Enemies spawn randomly after 1–3 player moves
✅ 1–3 enemies spawn at random top-row positions
✅ Enemies move down 1 tile each time the player moves
✅ Enemies vanish when reaching the player’s row

---

**Result:** The combat grid now dynamically spawns enemies that descend synchronously with player movement, maintaining consistent turn-based rhythm.
